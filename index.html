<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار التوفل ITP - النموذج الجديد</title>
    <style>
        /* تنسيق رأس الصفحة - معدل */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-bottom: 20px;
            padding: 10px;
            animation: bounceIn 1s ease-out;
        }
        
        .logo {
            height: 80px;
            width: auto;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.2)) brightness(1.05);
            border-radius: 12px;
            padding: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .logo:hover {
            transform: scale(1.08) rotate(2deg);
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3)) contrast(1.1);
        }
        
        /* تأثير الارتداد */
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* تنسيق المؤقت */
        .timer-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        #timer-container {
            text-align: center;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 2px solid #006400;
            margin-bottom: 10px;
            width: 100%;
        }
        
        #timer {
            font-size: 28px;
            font-weight: bold;
            color: #006400;
            font-family: 'Arial', sans-serif;
        }
        
        .timer-buttons {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        .timer-btn {
            padding: 8px 15px;
            margin: 0 5px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .timer-btn:hover {
            background: #2980b9;
        }
        
        .timer-btn.stop {
            background: #e74c3c;
        }
        
        .timer-btn.stop:hover {
            background: #c0392b;
        }
        
        /* باقي التنسيقات */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }
        
        h2 {
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        
        .section-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .question {
            margin-bottom: 25px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        
        .options {
            margin-right: 20px;
        }
        
        .option {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        
        .option:hover {
            background: #e3f2fd;
        }
        
        input[type="radio"] {
            margin-left: 10px;
        }
        
        button {
            display: block;
            width: 200px;
            padding: 12px;
            margin: 30px auto;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        #result {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
            background: #f8f9fa;
        }
        
        .correct {
            color: #2e7d32;
        }
        
        .wrong {
            color: #c62828;
        }
        
        .explanation {
            display: none;
            margin-top: 15px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 5px;
            border-right: 3px solid #4caf50;
        }
        
        .show-explanation {
            color: #0277bd;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            display: inline-block;
        }
        
        .show-explanation:hover {
            text-decoration: underline;
        }
        
        .reading-passage {
            background: #fff8e1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #ffa000;
        }
        
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .tab button {
            float: right;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 10px 16px;
            transition: 0.3s;
            font-size: 14px;
            width: auto;
            margin: 5px;
            border-radius: 3px;
        }
        
        .tab button:hover {
            background-color: #ddd;
        }
        
        .tab button.active {
            background-color: #3498db;
            color: white;
        }
        
        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
            animation: fadeEffect 1s;
        }
        
        @keyframes fadeEffect {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        
        .tts-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .play-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px auto;
            display: block;
            width: 150px;
        }
        
        .play-btn:hover {
            background: #3367d6;
        }
        
        .hidden-audio-text {
            display: none;
        }
        
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .control-btn {
            padding: 5px 10px;
            border-radius: 4px;
            background: #f1f1f1;
            border: 1px solid #ddd;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- رأس الصفحة مع الشعار والمؤقت -->
        <div class="header">
            <div class="logo-container">
                <img src="https://i.postimg.cc/R6Xj8PRc/logo.png" alt="شعار اختبار التوفل" class="logo">
            </div>
            
            <div class="timer-controls">
                <div id="timer-container">
                    <div id="timer">00:00:00</div>
                </div>
                <div class="timer-buttons">
                    <button class="timer-btn" onclick="startTimer()">بدء</button>
                    <button class="timer-btn stop" onclick="stopTimer()">إيقاف</button>
                </div>
            </div>
        </div>
        
        <h1>اختبار التوفل ITP - النموذج الجديد</h1>
        
        <div class="tab">
            <button class="tablinks active" onclick="openSection(event, 'structure')">Structure (20 سؤالاً)</button>
            <button class="tablinks" onclick="openSection(event, 'reading')">Reading (20 سؤالاً)</button>
            <button class="tablinks" onclick="openSection(event, 'listening')">Listening (10 أسئلة)</button>
        </div>
        
        <div id="structure" class="tabcontent" style="display: block;">
            <h2>القسم الأول: Structure and Written Expression</h2>
            <div class="section-info">
                <p>اختر الإجابة الصحيحة لاستكمال الجملة أو تصحيح الخطأ النحوي.</p>
            </div>
            <div id="structure-container"></div>
        </div>
        
        <div id="reading" class="tabcontent">
            <h2>القسم الثاني: Reading Comprehension</h2>
            <div class="section-info">
                <p>اقرأ النصوص التالية ثم اختر الإجابة الصحيحة للأسئلة.</p>
            </div>
            <div id="reading-container"></div>
        </div>
        
        <div id="listening" class="tabcontent">
            <h2>القسم الثالث: Listening Comprehension</h2>
            <div class="section-info">
                <p>انقر على زر التشغيل للاستماع إلى كل مقطع ثم اختر الإجابة الصحيحة.</p>
            </div>
            <div id="listening-container"></div>
        </div>
        
        <button onclick="calculateScore()">عرض النتيجة النهائية</button>
        
        <div id="result"></div>
    </div>

    <script>
        // متغيرات المؤقت
        let seconds = 0;
        let minutes = 0;
        let hours = 0;
        let timerInterval;
        let timerRunning = false;
        
        // دالة تحديث المؤقت
        function updateTimer() {
            seconds++;
            
            if (seconds >= 60) {
                seconds = 0;
                minutes++;
            }
            
            if (minutes >= 60) {
                minutes = 0;
                hours++;
            }
            
            document.getElementById('timer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // بدء المؤقت
        function startTimer() {
            if (!timerRunning) {
                timerInterval = setInterval(updateTimer, 1000);
                timerRunning = true;
                document.getElementById('timer').style.color = '#006400';
            }
        }
        
        // إيقاف المؤقت
        function stopTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
            document.getElementById('timer').style.color = '#8b0000';
        }

        // Structure and Written Expression (20 سؤالاً)
        const structureQuestions = [
            {
        question: "1. The Pacific Ocean is deeper than ___ ocean in the world.",
        options: ["A) any", "B) any other", "C) other", "D) another"],
        correctAnswer: 1,
        explanation: "الإجابة الصحيحة: B) any other<br><br>الشرح: عند المقارنة مع بقية نفس المجموعة نستخدم 'any other'."
    },
    {
        question: "2. ____ the light rain, the baseball game continued.",
        options: ["A) Although", "B) Even though", "C) Despite", "D) Because"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) Despite<br><br>الشرح: 'Despite' يليها اسم أو عبارة اسمية، مثل 'the light rain'."
    },
    {
        question: "3. Some birds, such as pigeons, are believed ___ the Earth’s magnetic field to navigate.",
        options: ["A) using", "B) use", "C) to use", "D) to using"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) to use<br><br>الشرح: 'are believed' يتبعها مصدر كامل (to + verb)."
    },
    {
        question: "4. The larger the city, ___ the crime rate tends to be.",
        options: ["A) highest", "B) higher", "C) the higher", "D) the highest"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) the higher<br><br>الشرح: تركيبة the + comparative لبيان العلاقة الطردية."
    },
    {
        question: "5. There are many theories about ___ dinosaurs became extinct.",
        options: ["A) why", "B) that", "C) what", "D) how come"],
        correctAnswer: 0,
        explanation: "الإجابة الصحيحة: A) why<br><br>الشرح: 'why' تستخدم بعد 'about' للتعبير عن السبب."
    },
    {
        question: "6. Neither the teacher nor the students ___ ready for the presentation.",
        options: ["A) was", "B) were", "C) is", "D) be"],
        correctAnswer: 1,
        explanation: "الإجابة الصحيحة: B) were<br><br>الشرح: الفعل يتبع الفاعل الأقرب وهو 'students'."
    },
    {
        question: "7. The painting was so beautiful that I couldn’t take my eyes ___ it.",
        options: ["A) at", "B) over", "C) of", "D) off"],
        correctAnswer: 3,
        explanation: "الإجابة الصحيحة: D) off<br><br>الشرح: التعبير الصحيح هو 'take my eyes off'."
    },
    {
        question: "8. Not only ___ all the tickets, but they also gave away free posters.",
        options: ["A) they sold", "B) sold they", "C) did they sell", "D) do they sell"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) did they sell<br><br>الشرح: بعد 'Not only' نستخدم صيغة السؤال (did + فاعل + فعل)."
    },
    {
        question: "9. ___ its small size, the device is very powerful.",
        options: ["A) Although", "B) Due to", "C) Because of", "D) Despite"],
        correctAnswer: 3,
        explanation: "الإجابة الصحيحة: D) Despite<br><br>الشرح: 'Despite' يليها اسم وليس جملة."
    },
    {
        question: "10. She asked me ___ I had seen her notebook.",
        options: ["A) that", "B) if", "C) what", "D) how"],
        correctAnswer: 1,
        explanation: "الإجابة الصحيحة: B) if<br><br>الشرح: 'if' تُستخدم للسؤال غير المباشر بنعم أو لا."
    },
    {
        question: "11. The company has been successful ___ its recent challenges.",
        options: ["A) because", "B) although", "C) in spite of", "D) due"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) in spite of<br><br>الشرح: 'in spite of' يليها اسم وتُستخدم لبيان التناقض."
    },
    {
        question: "12. The teacher explained the lesson clearly, ___ helped the students understand better.",
        options: ["A) which", "B) who", "C) whom", "D) that"],
        correctAnswer: 0,
        explanation: "الإجابة الصحيحة: A) which<br><br>الشرح: 'which' تشير للجملة السابقة وتربطها بالتفسير."
    },
    {
        question: "13. Tom runs faster than ___ in his class.",
        options: ["A) any boys", "B) any boy", "C) other boy", "D) every boy"],
        correctAnswer: 1,
        explanation: "الإجابة الصحيحة: B) any boy<br><br>الشرح: نستخدم المفرد بعد 'any' في المقارنة داخل نفس المجموعة."
    },
    {
        question: "14. It was not until she arrived ___ the meeting began.",
        options: ["A) when", "B) that", "C) then", "D) so"],
        correctAnswer: 1,
        explanation: "الإجابة الصحيحة: B) that<br><br>الشرح: التركيب الصحيح هو 'It was not until... that...'."
    },
    {
        question: "15. The cake tastes ___ than it looks.",
        options: ["A) well", "B) good", "C) better", "D) best"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) better<br><br>الشرح: 'tastes' يليها صفة، و'better' للمقارنة."
    },
    {
        question: "16. This is the restaurant ___ we had our first date.",
        options: ["A) which", "B) that", "C) where", "D) what"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) where<br><br>الشرح: نستخدم 'where' للإشارة إلى مكان."
    },
    {
        question: "17. He hardly ___ his family since he moved abroad.",
        options: ["A) saw", "B) has seen", "C) sees", "D) is seeing"],
        correctAnswer: 1,
        explanation: "الإجابة الصحيحة: B) has seen<br><br>الشرح: 'since' يتطلب present perfect."
    },
    {
        question: "18. The scientist, along with his assistants, ___ working on the new vaccine.",
        options: ["A) are", "B) were", "C) is", "D) have"],
        correctAnswer: 2,
        explanation: "الإجابة الصحيحة: C) is<br><br>الشرح: الفعل يتبع الفاعل الأساسي وليس الجزء المضاف."
    },
    {
        question: "19. We won’t start the meeting ___ the manager arrives.",
        options: ["A) after", "B) until", "C) when", "D) during"],
        correctAnswer: 1,
        explanation: "الإجابة الصحيحة: B) until<br><br>الشرح: نستخدم 'until' للدلالة على تأجيل الحدث حتى يحدث آخر."
    },
    {
        question: "20. Jane prefers tea ___ coffee in the morning.",
        options: ["A) to", "B) over", "C) than", "D) from"],
        correctAnswer: 0,
        explanation: "الإجابة الصحيحة: A) to<br><br>الشرح: التركيب الصحيح هو 'prefer X to Y'."
    }
];

        // Reading Comprehension (20 سؤالاً)
        const readingData = [
            {
                passage: "The digital revolution has transformed how we communicate and access information. With the advent of smartphones and high-speed internet, people can now connect instantly across the globe. This technological shift has impacted various sectors including education, business, and entertainment. While these advancements offer numerous benefits, they also raise concerns about privacy and digital addiction.",
                questions: [
                    {
                        question: "1. What has the digital revolution transformed?",
                        options: ["A) Transportation methods", "B) Communication and information access", "C) Agricultural techniques", "D) Medical procedures"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) Communication and information access<br><br>الشرح: النص يذكر أن الثورة الرقمية غيرت طريقة التواصل والوصول للمعلومات."
                    },
                    {
                        question: "2. What technological developments enabled this transformation?",
                        options: ["A) Smartphones and high-speed internet", "B) Solar panels and wind turbines", "C) Hybrid cars and electric vehicles", "D) Satellites and space exploration"],
                        correctAnswer: 0,
                        explanation: "الإجابة الصحيحة: A) Smartphones and high-speed internet<br><br>الشرح: النص يذكر الهواتف الذكية والإنترنت السريع كمحركين لهذا التحول."
                    },
                    {
                        question: "3. Which sectors are mentioned as being impacted?",
                        options: ["A) Education, business, and entertainment", "B) Agriculture, mining, and construction", "C) Healthcare, tourism, and sports", "D) Manufacturing, retail, and transportation"],
                        correctAnswer: 0,
                        explanation: "الإجابة الصحيحة: A) Education, business, and entertainment<br><br>الشرح: النص يذكر هذه القطاعات الثلاثة كمستفيدة من التطورات."
                    },
                    {
                        question: "4. What concerns are raised about these advancements?",
                        options: ["A) Cost and maintenance", "B) Privacy and digital addiction", "C) Safety and reliability", "D) Availability and accessibility"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) Privacy and digital addiction<br><br>الشرح: النص يذكر مخاوف تتعلق بالخصوصية والإدمان الرقمي."
                    }
                ]
            },
            {
                passage: "Climate change is one of the most pressing issues facing humanity today. Rising global temperatures lead to melting glaciers, rising sea levels, and extreme weather events. Scientists agree that human activities, particularly the burning of fossil fuels, are the primary contributors to this phenomenon. Addressing climate change requires international cooperation and sustainable practices.",
                questions: [
                    {
                        question: "5. How is climate change described in the passage?",
                        options: ["A) A minor environmental fluctuation", "B) One of the most pressing issues", "C) A naturally occurring cycle", "D) A localized weather pattern"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) One of the most pressing issues<br><br>الشرح: النص يصف تغير المناخ بأنه من أكثر القضايا إلحاحاً."
                    },
                    {
                        question: "6. What are mentioned as consequences of rising temperatures?",
                        options: ["A) Increased agricultural productivity", "B) Melting glaciers and rising sea levels", "C) More stable weather patterns", "D) Expansion of polar ice caps"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) Melting glaciers and rising sea levels<br><br>الشرح: النص يذكر ذوبان الجليد وارتفاع منسوب البحار."
                    },
                    {
                        question: "7. What is identified as the primary cause of climate change?",
                        options: ["A) Volcanic activity", "B) Solar radiation", "C) Human activities", "D) Natural climate cycles"],
                        correctAnswer: 2,
                        explanation: "الإجابة الصحيحة: C) Human activities<br><br>الشرح: النص يذكر أن الأنشطة البشرية هي السبب الرئيسي."
                    },
                    {
                        question: "8. What does addressing climate change require according to the passage?",
                        options: ["A) National isolation", "B) International cooperation", "C) Technological stagnation", "D) Increased fossil fuel use"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) International cooperation<br><br>الشرح: النص يذكر أن الحل يتطلب تعاوناً دولياً."
                    }
                ]
            },
            {
                passage: "The human digestive system is a complex series of organs that processes food for energy and nutrients. It begins in the mouth where food is chewed and mixed with saliva, then travels through the esophagus to the stomach. After being broken down in the stomach, food moves to the small intestine where nutrients are absorbed, and finally to the large intestine where water is absorbed before waste is eliminated.",
                questions: [
                    {
                        question: "9. What is the main function of the digestive system?",
                        options: ["A) Pumping blood throughout the body", "B) Processing food for energy and nutrients", "C) Filtering toxins from the blood", "D) Producing hormones for growth"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) Processing food for energy and nutrients<br><br>الشرح: النص يذكر أن هذه هي الوظيفة الأساسية للجهاز الهضمي."
                    },
                    {
                        question: "10. Where does digestion begin?",
                        options: ["A) Stomach", "B) Small intestine", "C) Mouth", "D) Esophagus"],
                        correctAnswer: 2,
                        explanation: "الإجابة الصحيحة: C) Mouth<br><br>الشرح: النص يذكر أن الهضم يبدأ في الفم."
                    },
                    {
                        question: "11. What happens to food in the stomach?",
                        options: ["A) Nutrients are absorbed", "B) It is broken down", "C) Water is removed", "D) It is converted to energy"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) It is broken down<br><br>الشرح: النص يذكر أن الطعام يتفكك في المعدة."
                    },
                    {
                        question: "12. Where does most nutrient absorption occur?",
                        options: ["A) Mouth", "B) Stomach", "C) Small intestine", "D) Large intestine"],
                        correctAnswer: 2,
                        explanation: "الإجابة الصحيحة: C) Small intestine<br><br>الشرح: النص يذكر أن الامتصاص الرئيسي للعناصر الغذائية يحدث في الأمعاء الدقيقة."
                    }
                ]
            },
            {
                passage: "Artificial intelligence (AI) is revolutionizing various industries by enabling machines to perform tasks that typically require human intelligence. AI applications range from voice assistants and recommendation systems to medical diagnosis and autonomous vehicles. While AI offers tremendous potential, it also raises ethical concerns regarding job displacement, privacy, and decision-making transparency.",
                questions: [
                    {
                        question: "13. What is artificial intelligence enabling machines to do?",
                        options: ["A) Perform manual labor only", "B) Tasks requiring human intelligence", "C) Basic mathematical calculations", "D) Simple repetitive tasks"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) Tasks requiring human intelligence<br><br>الشرح: النص يذكر أن الذكاء الاصطناعي يمكن الآلات من أداء مهام تحتاج ذكاءً بشرياً."
                    },
                    {
                        question: "14. Which of these is mentioned as an AI application?",
                        options: ["A) Voice assistants", "B) Solar panels", "C) Wind turbines", "D) Steam engines"],
                        correctAnswer: 0,
                        explanation: "الإجابة الصحيحة: A) Voice assistants<br><br>الشرح: النص يذكر المساعدات الصوتية كأحد تطبيقات الذكاء الاصطناعي."
                    },
                    {
                        question: "15. What potential does AI offer according to the passage?",
                        options: ["A) Limited and specialized", "B) Moderate and controlled", "C) Tremendous and wide-ranging", "D) Minimal and predictable"],
                        correctAnswer: 2,
                        explanation: "الإجابة الصحيحة: C) Tremendous and wide-ranging<br><br>الشرح: النص يذكر أن الذكاء الاصطناعي يقدم إمكانيات هائلة."
                    },
                    {
                        question: "16. What concerns are raised about AI?",
                        options: ["A) Cost and maintenance", "B) Size and weight", "C) Job displacement and privacy", "D) Speed and efficiency"],
                        correctAnswer: 2,
                        explanation: "الإجابة الصحيحة: C) Job displacement and privacy<br><br>الشرح: النص يذكر مخاوف تتعلق بفقدان الوظائف والخصوصية."
                    }
                ]
            },
            {
                passage: "The Renaissance was a period of cultural and intellectual rebirth in Europe between the 14th and 17th centuries. It marked the transition from the Middle Ages to modernity, characterized by renewed interest in classical learning and values. The Renaissance saw significant developments in art, literature, science, and philosophy, with figures like Leonardo da Vinci, Michelangelo, and Galileo making groundbreaking contributions.",
                questions: [
                    {
                        question: "17. What was the Renaissance?",
                        options: ["A) A military conflict", "B) A period of cultural rebirth", "C) An economic depression", "D) A religious movement"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) A period of cultural rebirth<br><br>الشرح: النص يصف عصر النهضة بأنه فترة إحياء ثقافي."
                    },
                    {
                        question: "18. When did the Renaissance occur?",
                        options: ["A) 5th to 8th centuries", "B) 9th to 12th centuries", "C) 14th to 17th centuries", "D) 18th to 20th centuries"],
                        correctAnswer: 2,
                        explanation: "الإجابة الصحيحة: C) 14th to 17th centuries<br><br>الشرح: النص يذكر أن عصر النهضة كان بين القرنين 14 و17."
                    },
                    {
                        question: "19. What characterized the Renaissance?",
                        options: ["A) Decline in education", "B) Renewed interest in classical learning", "C) Rejection of scientific inquiry", "D) Isolation from other cultures"],
                        correctAnswer: 1,
                        explanation: "الإجابة الصحيحة: B) Renewed interest in classical learning<br><br>الشرح: النص يذكر الاهتمام المتجدد بالتعلم الكلاسيكي كسمة رئيسية."
                    },
                    {
                        question: "20. Which Renaissance figure is mentioned in the passage?",
                        options: ["A) Albert Einstein", "B) William Shakespeare", "C) Leonardo da Vinci", "D) Isaac Newton"],
                        correctAnswer: 2,
                        explanation: "الإجابة الصحيحة: C) Leonardo da Vinci<br><br>الشرح: النص يذكر ليوناردو دا فينشي كأحد أعلام عصر النهضة."
                    }
                ]
            }
        ];

        // Listening Comprehension (10 أسئلة)
        const listeningQuestions = [
           {
    "audioText": "Man: Where did you put the keys? Woman: They’re on the kitchen counter, next to the fruit bowl.",
    "question": "1. Where are the keys?",
    "options": ["A) In the drawer", "B) On the table", "C) On the kitchen counter", "D) In the car"],
    "correctAnswer": 2,
    "explanation": "الإجابة الصحيحة: C) On the kitchen counter<br><br>الشرح: المرأة قالت إن المفاتيح على طاولة المطبخ بجانب سلة الفاكهة."
  },
  {
    "audioText": "Woman: Are you coming to the office party tonight? Man: I’m not sure. I have a lot of work to finish.",
    "question": "2. Why might the man not attend the party?",
    "options": ["A) He is feeling sick", "B) He has too much work", "C) He doesn’t like parties", "D) He is out of town"],
    "correctAnswer": 1,
    "explanation": "الإجابة الصحيحة: B) He has too much work<br><br>الشرح: الرجل قال إنه غير متأكد بسبب كثرة العمل المتبقي عليه."
  },
  {
    "audioText": "Man: The traffic was terrible this morning. Woman: I know, I was stuck on the highway for over an hour.",
    "question": "3. What happened to the woman this morning?",
    "options": ["A) She missed a meeting", "B) She had car trouble", "C) She was delayed by traffic", "D) She overslept"],
    "correctAnswer": 2,
    "explanation": "الإجابة الصحيحة: C) She was delayed by traffic<br><br>الشرح: المرأة قالت إنها علقت في الطريق السريع لأكثر من ساعة."
  },
  {
    "audioText": "Woman: I can’t find my phone. Man: Did you check your bag?",
    "question": "4. What does the man suggest the woman do?",
    "options": ["A) Call her phone", "B) Buy a new one", "C) Check her bag", "D) Go back to the office"],
    "correctAnswer": 2,
    "explanation": "الإجابة الصحيحة: C) Check her bag<br><br>الشرح: الرجل سألها إن كانت قد فتشت حقيبتها."
  },
  {
    "audioText": "Man: What time does the movie start? Woman: At 7:30, but we should get there early to find good seats.",
    "question": "5. Why does the woman want to arrive early?",
    "options": ["A) To buy snacks", "B) To meet friends", "C) To get good seats", "D) To avoid traffic"],
    "correctAnswer": 2,
    "explanation": "الإجابة الصحيحة: C) To get good seats<br><br>الشرح: المرأة قالت أنه من الأفضل أن يصلوا مبكرًا لإيجاد مقاعد جيدة."
  },
  {
    "audioText": "Woman: The elevator is out of service again. Man: I guess we’ll have to take the stairs.",
    "question": "6. What will they probably do?",
    "options": ["A) Wait for the elevator", "B) Take the stairs", "C) Call maintenance", "D) Go home"],
    "correctAnswer": 1,
    "explanation": "الإجابة الصحيحة: B) Take the stairs<br><br>الشرح: الرجل قال إنهم سيضطرون لاستخدام الدرج."
  },
  {
    "audioText": "Man: Do you want to go hiking this weekend? Woman: That sounds great! I’ve been wanting to get some fresh air.",
    "question": "7. What does the woman think about going hiking?",
    "options": ["A) She’s not interested", "B) She has other plans", "C) She thinks it’s a good idea", "D) She’s afraid of hiking"],
    "correctAnswer": 2,
    "explanation": "الإجابة الصحيحة: C) She thinks it’s a good idea<br><br>الشرح: المرأة قالت إنه يبدو رائعًا وأنها كانت ترغب في الخروج للهواء النقي."
  },
  {
    "audioText": "Woman: I’m going to the grocery store. Do we need anything? Man: Yes, we’re out of milk and eggs.",
    "question": "8. What does the man ask the woman to buy?",
    "options": ["A) Bread and cheese", "B) Milk and eggs", "C) Vegetables and fruit", "D) Juice and cereal"],
    "correctAnswer": 1,
    "explanation": "الإجابة الصحيحة: B) Milk and eggs<br><br>الشرح: الرجل قال إن الحليب والبيض غير متوفرين."
  },
  {
    "audioText": "Man: How was your vacation in Spain? Woman: It was amazing! The beaches were beautiful.",
    "question": "9. What did the woman like most about her vacation?",
    "options": ["A) The food", "B) The culture", "C) The beaches", "D) The shopping"],
    "correctAnswer": 2,
    "explanation": "الإجابة الصحيحة: C) The beaches<br><br>الشرح: المرأة قالت إن الشواطئ كانت جميلة، مما يدل على إعجابها بها."
  },
  {
    "audioText": "Woman: I have to give a presentation tomorrow. Man: Good luck! I’m sure you’ll do great.",
    "question": "10. What is the man doing?",
    "options": ["A) Offering help", "B) Wishing her luck", "C) Giving advice", "D) Criticizing her"],
    "correctAnswer": 1,
    "explanation": "الإجابة الصحيحة: B) Wishing her luck<br><br>الشرح: الرجل قال 'حظًا سعيدًا' مما يعني أنه يتمنى لها التوفيق."
  }
        ];

        // دالة تحويل النص إلى كلام
        function speakText(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = "en-US";
            utterance.rate = 0.9;
            utterance.pitch = 1;
            
            const voices = window.speechSynthesis.getVoices();
            const googleVoice = voices.find(voice => 
                voice.lang === 'en-US' && voice.name.includes('Google'));
            utterance.voice = googleVoice || voices.find(voice => voice.lang === 'en-US');
            
            window.speechSynthesis.speak(utterance);
        }

        // عرض الأسئلة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            displayQuestions();
            
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        });

        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            console.log("الأصوات المتاحة:", voices);
        }

        function displayQuestions() {
            const structureContainer = document.getElementById('structure-container');
            structureQuestions.forEach((q, index) => {
                createQuestionElement(structureContainer, q, index, 'structure');
            });

            const readingContainer = document.getElementById('reading-container');
            readingData.forEach((section, sectionIndex) => {
                const passageDiv = document.createElement('div');
                passageDiv.className = 'reading-passage';
                passageDiv.innerHTML = `<p>${section.passage}</p>`;
                readingContainer.appendChild(passageDiv);

                section.questions.forEach((q, qIndex) => {
                    createQuestionElement(readingContainer, q, qIndex + (sectionIndex * 4), 'reading');
                });
            });

            const listeningContainer = document.getElementById('listening-container');
            listeningQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.id = `listening-question-${index}`;
                
                questionDiv.innerHTML = `
                    <div class="hidden-audio-text">${q.audioText}</div>
                    <div class="tts-container">
                        <button class="play-btn" onclick="speakText(this.parentNode.previousElementSibling.textContent)">
                            تشغيل السؤال ${index + 1}
                        </button>
                        <div class="audio-controls">
                            <button class="control-btn" onclick="speakText(this.parentNode.parentNode.previousElementSibling.textContent)">
                                إعادة
                            </button>
                            <button class="control-btn" onclick="window.speechSynthesis.cancel()">
                                إيقاف
                            </button>
                        </div>
                    </div>
                    <p>${q.question}</p>
                    <div class="options">
                        ${q.options.map((option, i) => `
                            <div class="option">
                                <input type="radio" name="listening-${index}" id="listening-${index}-${i}" value="${i}">
                                <label for="listening-${index}-${i}">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                    <span class="show-explanation" onclick="toggleExplanation('listening-${index}')">عرض الشرح</span>
                    <div class="explanation" id="explanation-listening-${index}">${q.explanation}</div>
                `;
                
                listeningContainer.appendChild(questionDiv);
            });
        }

        function createQuestionElement(container, q, index, section) {
            if (section === 'listening') return;
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.id = `${section}-question-${index}`;

            questionDiv.innerHTML = `
                <p>${q.question}</p>
                <div class="options">
                    ${q.options.map((option, i) => `
                        <div class="option">
                            <input type="radio" name="${section}-${index}" id="${section}-${index}-${i}" value="${i}">
                            <label for="${section}-${index}-${i}">${option}</label>
                        </div>
                    `).join('')}
                </div>
                <span class="show-explanation" onclick="toggleExplanation('${section}-${index}')">عرض الشرح</span>
                <div class="explanation" id="explanation-${section}-${index}">${q.explanation}</div>
            `;

            container.appendChild(questionDiv);
        }

        function toggleExplanation(id) {
            const explanation = document.getElementById(`explanation-${id}`);
            explanation.style.display = explanation.style.display === 'block' ? 'none' : 'block';
        }

        function openSection(evt, sectionName) {
            const tabcontent = document.getElementsByClassName('tabcontent');
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = 'none';
            }

            const tablinks = document.getElementsByClassName('tablinks');
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(' active', '');
            }

            document.getElementById(sectionName).style.display = 'block';
            evt.currentTarget.className += ' active';
        }

        function calculateScore() {
            let structureScore = 0;
            let readingScore = 0;
            let listeningScore = 0;

            // حساب نتيجة Structure
            structureQuestions.forEach((q, index) => {
                const selectedOption = document.querySelector(`input[name="structure-${index}"]:checked`);
                const questionDiv = document.getElementById(`structure-question-${index}`);

                if (selectedOption && parseInt(selectedOption.value) === q.correctAnswer) {
                    structureScore++;
                    questionDiv.style.borderLeft = '4px solid #2e7d32';
                } else {
                    questionDiv.style.borderLeft = '4px solid #c62828';
                }
                document.getElementById(`explanation-structure-${index}`).style.display = 'block';
            });

            // حساب نتيجة Reading
            let readingIndex = 0;
            readingData.forEach(section => {
                section.questions.forEach(q => {
                    const selectedOption = document.querySelector(`input[name="reading-${readingIndex}"]:checked`);
                    const questionDiv = document.getElementById(`reading-question-${readingIndex}`);

                    if (selectedOption && parseInt(selectedOption.value) === q.correctAnswer) {
                        readingScore++;
                        questionDiv.style.borderLeft = '4px solid #2e7d32';
                    } else {
                        questionDiv.style.borderLeft = '4px solid #c62828';
                    }
                    document.getElementById(`explanation-reading-${readingIndex}`).style.display = 'block';
                    readingIndex++;
                });
            });

            // حساب نتيجة Listening
            listeningQuestions.forEach((q, index) => {
                const selectedOption = document.querySelector(`input[name="listening-${index}"]:checked`);
                const questionDiv = document.getElementById(`listening-question-${index}`);

                if (selectedOption && parseInt(selectedOption.value) === q.correctAnswer) {
                    listeningScore++;
                    questionDiv.style.borderLeft = '4px solid #2e7d32';
                } else {
                    questionDiv.style.borderLeft = '4px solid #c62828';
                }
                document.getElementById(`explanation-listening-${index}`).style.display = 'block';
            });

            // عرض النتيجة النهائية
            const totalScore = structureScore + readingScore + listeningScore;
            const percentage = (totalScore / 50) * 100;
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = `
                <p>النتيجة النهائية: ${totalScore} / 50</p>
                <p>النسبة المئوية: ${percentage.toFixed(1)}%</p>
                <p>Structure: ${structureScore} / 20</p>
                <p>Reading: ${readingScore} / 20</p>
                <p>Listening: ${listeningScore} / 10</p>
            `;
            
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // جعل الدوال متاحة على النطاق العام
        window.toggleExplanation = toggleExplanation;
        window.openSection = openSection;
        window.calculateScore = calculateScore;
        window.speakText = speakText;
        window.startTimer = startTimer;
        window.stopTimer = stopTimer;
    </script>
</body>
</html>
